<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Linux 组 raid 1</title>
      <link href="/2025/07/13/Linux-%E7%BB%84-raid-1/"/>
      <url>/2025/07/13/Linux-%E7%BB%84-raid-1/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux-组-raid-1"><a href="#Linux-组-raid-1" class="headerlink" title="Linux 组 raid 1"></a>Linux 组 raid 1</h1><h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><ul><li><p>服务器环境</p><p>  Debian GNU&#x2F;Linux 12 (bookworm)</p></li></ul><p>前段时间在家翻箱子翻到了两块 14 年的机械硬盘，一块是西数的蓝盘，另一块是 seg 什么的，不知道是什么牌子，反正放着也是放着，思来想去，想用来当自己的储存服务器，储存一些需要持久化储存的数据，例如照片、视频或者一些比较重要的数据什么的</p><p>实话说这两块硬盘不是很敢用，什么时候突然暴毙就完蛋了，但是突然又想起了之前在微信公众号看到的一种技术方式——磁盘冗余阵列，根据各个 raid 等级可以用两个或多个硬盘组成不同的效果，可以让自己的数据储存的更放心一些，所以也就有了这篇文章</p><p>这篇文章我想记录一下组 raid 1 的过程以及踩坑记录，希望能不翻车。</p><h2 id="安装-mdadm"><a href="#安装-mdadm" class="headerlink" title="安装 mdadm"></a>安装 mdadm</h2><p>Mdadm 是管理 Linux 上软件 RAID 的实用程序。它在所有主要发行版中都可用。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get update &amp;&amp; <span class="built_in">sudo</span> apt-get install mdadm</span><br></pre></td></tr></table></figure><p>首先看一下我的两个机械硬盘属于被识别为什么名字，其中 sdc 是我的两个机械硬盘，之前装飞牛 nas 遗留的 raid 0，还没有怎么处理它</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># lsblk</span></span><br><span class="line">NAME                                              MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINTS</span><br><span class="line">sda                                                 8:0    0 931.5G  0 disk</span><br><span class="line">└─sda1                                              8:1    0 931.5G  0 part</span><br><span class="line">  └─md127                                           9:127  0   1.8T  0 raid0</span><br><span class="line">    └─trim_53fde9e3_abc8_4c19_9692_c236b5ce6dcf-0 254:2    0   1.8T  0 lvm</span><br><span class="line">sdb                                                 8:16   0 119.2G  0 disk</span><br><span class="line">├─sdb1                                              8:17   0   512M  0 part  /boot/efi</span><br><span class="line">├─sdb2                                              8:18   0   488M  0 part  /boot</span><br><span class="line">└─sdb3                                              8:19   0 118.3G  0 part</span><br><span class="line">  ├─Rubbish--computer--vg-root                    254:0    0     1T  0 lvm   /</span><br><span class="line">  └─Rubbish--computer--vg-swap_1                  254:1    0   980M  0 lvm   [SWAP]</span><br><span class="line">sdc                                                 8:32   0 931.5G  0 disk</span><br><span class="line">└─sdc1                                              8:33   0 931.5G  0 part</span><br><span class="line">  └─md127                                           9:127  0   1.8T  0 raid0</span><br><span class="line">    └─trim_53fde9e3_abc8_4c19_9692_c236b5ce6dcf-0 254:2    0   1.8T  0 lvm</span><br><span class="line">nvme0n1                                           259:0    0 931.5G  0 disk</span><br><span class="line">└─nvme0n1p1                                       259:1    0 931.5G  0 part</span><br><span class="line">  └─Rubbish--computer--vg-root                    254:0    0     1T  0 lvm   /</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="卸载原来的-raid-0"><a href="#卸载原来的-raid-0" class="headerlink" title="卸载原来的 raid 0"></a>卸载原来的 raid 0</h2><p>直接给 sda 和 sdc 重新分区就好了</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fdisk /dev/sda</span><br><span class="line">// 按 n，一直回车，然后按 w 保存</span><br><span class="line">fdisk /dev/sdc</span><br><span class="line">// 同上</span><br></pre></td></tr></table></figure><p>操作完之后重启一下，输入 lsblk 就变成了这样</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@Rubbish-computer:~# lsblk</span><br><span class="line">NAME                             MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda                                8:0    0 931.5G  0 disk</span><br><span class="line">└─sda1                             8:1    0 931.5G  0 part</span><br><span class="line">sdb                                8:16   0 119.2G  0 disk</span><br><span class="line">├─sdb1                             8:17   0   512M  0 part /boot/efi</span><br><span class="line">├─sdb2                             8:18   0   488M  0 part /boot</span><br><span class="line">└─sdb3                             8:19   0 118.3G  0 part</span><br><span class="line">  ├─Rubbish--computer--vg-root   254:0    0     1T  0 lvm  /</span><br><span class="line">  └─Rubbish--computer--vg-swap_1 254:1    0   980M  0 lvm  [SWAP]</span><br><span class="line">sdc                                8:32   0 931.5G  0 disk</span><br><span class="line">└─sdc1                             8:33   0 931.5G  0 part</span><br><span class="line">nvme0n1                          259:0    0 931.5G  0 disk</span><br><span class="line">└─nvme0n1p1                      259:1    0 931.5G  0 part</span><br><span class="line">  └─Rubbish--computer--vg-root   254:0    0     1T  0 lvm  /</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="组-raid-1"><a href="#组-raid-1" class="headerlink" title="组 raid 1"></a>组 raid 1</h2><p>照着输命令，这个命令的意思是在 md1 上创建 raid1，然后选择硬盘</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mdadm --create --verbose /dev/md1 --level=1 --raid-devices=2 /dev/sda1 /dev/sdc1</span><br><span class="line">// 有选项就输 y</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@Rubbish-computer:~# lsblk</span><br><span class="line">NAME                             MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINTS</span><br><span class="line">sda                                8:0    0 931.5G  0 disk</span><br><span class="line">└─sda1                             8:1    0 931.5G  0 part</span><br><span class="line">  └─md1                            9:1    0 931.4G  0 raid1</span><br><span class="line">sdb                                8:16   0 119.2G  0 disk</span><br><span class="line">├─sdb1                             8:17   0   512M  0 part  /boot/efi</span><br><span class="line">├─sdb2                             8:18   0   488M  0 part  /boot</span><br><span class="line">└─sdb3                             8:19   0 118.3G  0 part</span><br><span class="line">  ├─Rubbish--computer--vg-root   254:0    0     1T  0 lvm   /</span><br><span class="line">  └─Rubbish--computer--vg-swap_1 254:1    0   980M  0 lvm   [SWAP]</span><br><span class="line">sdc                                8:32   0 931.5G  0 disk</span><br><span class="line">└─sdc1                             8:33   0 931.5G  0 part</span><br><span class="line">  └─md1                            9:1    0 931.4G  0 raid1</span><br><span class="line">nvme0n1                          259:0    0 931.5G  0 disk</span><br><span class="line">└─nvme0n1p1                      259:1    0 931.5G  0 part</span><br><span class="line">  └─Rubbish--computer--vg-root   254:0    0     1T  0 lvm   /</span><br><span class="line">root@Rubbish-computer:~# fdisk /dev/m</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>给 md1 新建分区</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fdisk /dev/md1</span><br><span class="line">// 依次输入: n -&gt; 回车 -&gt; 回车 -&gt; 回车  w</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@Rubbish-computer:~# lsblk</span><br><span class="line">NAME                             MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINTS</span><br><span class="line">sda                                8:0    0 931.5G  0 disk</span><br><span class="line">└─sda1                             8:1    0 931.5G  0 part</span><br><span class="line">  └─md1                            9:1    0 931.4G  0 raid1</span><br><span class="line">    └─md1p1                      259:2    0 931.4G  0 part</span><br><span class="line">sdb                                8:16   0 119.2G  0 disk</span><br><span class="line">├─sdb1                             8:17   0   512M  0 part  /boot/efi</span><br><span class="line">├─sdb2                             8:18   0   488M  0 part  /boot</span><br><span class="line">└─sdb3                             8:19   0 118.3G  0 part</span><br><span class="line">  ├─Rubbish--computer--vg-root   254:0    0     1T  0 lvm   /</span><br><span class="line">  └─Rubbish--computer--vg-swap_1 254:1    0   980M  0 lvm   [SWAP]</span><br><span class="line">sdc                                8:32   0 931.5G  0 disk</span><br><span class="line">└─sdc1                             8:33   0 931.5G  0 part</span><br><span class="line">  └─md1                            9:1    0 931.4G  0 raid1</span><br><span class="line">    └─md1p1                      259:2    0 931.4G  0 part</span><br><span class="line">nvme0n1                          259:0    0 931.5G  0 disk</span><br><span class="line">└─nvme0n1p1                      259:1    0 931.5G  0 part</span><br><span class="line">  └─Rubbish--computer--vg-root   254:0    0     1T  0 lvm   /</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>格式化 md1p1，格式为 ext4</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> mkfs.ext4 /dev/md1p1</span><br><span class="line"> <span class="built_in">mkdir</span> /mechanical_raid1</span><br><span class="line">mount /dev/md1p1 /mnt/mechanical_raid1/</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@Rubbish-computer:~# lsblk</span><br><span class="line">NAME                             MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINTS</span><br><span class="line">sda                                8:0    0 931.5G  0 disk</span><br><span class="line">└─sda1                             8:1    0 931.5G  0 part</span><br><span class="line">  └─md1                            9:1    0 931.4G  0 raid1</span><br><span class="line">    └─md1p1                      259:2    0 931.4G  0 part  /mnt/mechanical_raid1</span><br><span class="line">sdb                                8:16   0 119.2G  0 disk</span><br><span class="line">├─sdb1                             8:17   0   512M  0 part  /boot/efi</span><br><span class="line">├─sdb2                             8:18   0   488M  0 part  /boot</span><br><span class="line">└─sdb3                             8:19   0 118.3G  0 part</span><br><span class="line">  ├─Rubbish--computer--vg-root   254:0    0     1T  0 lvm   /</span><br><span class="line">  └─Rubbish--computer--vg-swap_1 254:1    0   980M  0 lvm   [SWAP]</span><br><span class="line">sdc                                8:32   0 931.5G  0 disk</span><br><span class="line">└─sdc1                             8:33   0 931.5G  0 part</span><br><span class="line">  └─md1                            9:1    0 931.4G  0 raid1</span><br><span class="line">    └─md1p1                      259:2    0 931.4G  0 part  /mnt/mechanical_raid1</span><br><span class="line">nvme0n1                          259:0    0 931.5G  0 disk</span><br><span class="line">└─nvme0n1p1                      259:1    0 931.5G  0 part</span><br><span class="line">  └─Rubbish--computer--vg-root   254:0    0     1T  0 lvm   /</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="配置开机挂载"><a href="#配置开机挂载" class="headerlink" title="配置开机挂载"></a>配置开机挂载</h2><p>查找 md1p1 的 UUID</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@Rubbish-computer:~# blkid</span><br><span class="line">/dev/mapper/Rubbish--computer--vg-swap_1: UUID=<span class="string">&quot;311186db-54d9-4e03-93b7-b2fa17b058f2&quot;</span> TYPE=<span class="string">&quot;swap&quot;</span></span><br><span class="line">/dev/nvme0n1p1: UUID=<span class="string">&quot;dm0hnz-6587-hDDp-kYup-OmtG-Mhp3-U23iZd&quot;</span> TYPE=<span class="string">&quot;LVM2_member&quot;</span> PARTUUID=<span class="string">&quot;f482e853-4f6b-3f48-9194-b574a2f2c6bd&quot;</span></span><br><span class="line">/dev/sdb2: UUID=<span class="string">&quot;c3c94fc5-5d17-44b7-ae10-122a34d801a3&quot;</span> BLOCK_SIZE=<span class="string">&quot;1024&quot;</span> TYPE=<span class="string">&quot;ext2&quot;</span> PARTUUID=<span class="string">&quot;5e0ac597-ccdd-496c-a33c-7b8f149fb276&quot;</span></span><br><span class="line">/dev/sdb3: UUID=<span class="string">&quot;90TQiF-6KDn-p4Eq-ZSXA-x4oA-Xq7Q-2SJF7t&quot;</span> TYPE=<span class="string">&quot;LVM2_member&quot;</span> PARTUUID=<span class="string">&quot;acc67b2c-f279-47d0-868c-89266ec5e3f1&quot;</span></span><br><span class="line">/dev/sdb1: UUID=<span class="string">&quot;2D83-6E26&quot;</span> BLOCK_SIZE=<span class="string">&quot;512&quot;</span> TYPE=<span class="string">&quot;vfat&quot;</span> PARTLABEL=<span class="string">&quot;EFI System Partition&quot;</span> PARTUUID=<span class="string">&quot;e0896f57-66c5-48ad-b51e-02fef04220f5&quot;</span></span><br><span class="line">/dev/mapper/Rubbish--computer--vg-root: UUID=<span class="string">&quot;91903da8-e448-4de6-abcf-2cc73d9ba92b&quot;</span> BLOCK_SIZE=<span class="string">&quot;4096&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span></span><br><span class="line">/dev/sdc1: UUID=<span class="string">&quot;23ec7260-b69e-aa05-96f8-f8393bee6722&quot;</span> UUID_SUB=<span class="string">&quot;64da14d7-8eb0-086a-eb46-a8948a5279cb&quot;</span> LABEL=<span class="string">&quot;Rubbish-computer:1&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span> PARTUUID=<span class="string">&quot;578b58f0-9d0c-1f4c-8dec-7f66b139dbe7&quot;</span></span><br><span class="line">/dev/sda1: UUID=<span class="string">&quot;23ec7260-b69e-aa05-96f8-f8393bee6722&quot;</span> UUID_SUB=<span class="string">&quot;3aa7b1db-83d0-81b2-a348-9de1b6035f40&quot;</span> LABEL=<span class="string">&quot;Rubbish-computer:1&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span> PARTUUID=<span class="string">&quot;71010802-ffff-df40-9b00-c0fdfb035a22&quot;</span></span><br><span class="line">/dev/md1p1: UUID=<span class="string">&quot;a637a848-0aec-4423-808c-fae7f5bb022a&quot;</span> BLOCK_SIZE=<span class="string">&quot;4096&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTUUID=<span class="string">&quot;e2da37e8-01&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>修改配置文件，a637a848-0aec-4423-808c-fae7f5bb022a 是md1p1 的UUID</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/fstab</span><br><span class="line"></span><br><span class="line">// 末尾添加下面这行，这个条目告诉系统在启动时将 UUID 为 </span><br><span class="line">// 5607a174-cfb3-476f-b509-a0e2e5f9654b 的 ext4 文件系统挂载到 /mnt/mechanical_raid1目录，</span><br><span class="line">// 使用默认挂载选项，不需要备份，并在启动时进行文件系统检查（在根文件系统之后）。</span><br><span class="line">UUID=a637a848-0aec-4423-808c-fae7f5bb022a /mnt/mechanical_raid1 ext4 defaults 0 2</span><br></pre></td></tr></table></figure><h2 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h2><p>为什么 916G 的总可用空间，只有 870G  可用？</p><p>因为默认情况下 ext4 保留约5%的空间给 root 用户(防止普通用户占满内存导致系统问题)，解决方式：将5%的保留空间调整到1%</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> tune2fs -m 1 /dev/md127p1  <span class="comment"># 将保留空间从 5% 改为 1%</span></span><br><span class="line"><span class="built_in">sudo</span> mount -o remount /mnt/mechanical_raid1  <span class="comment"># 重新挂载生效</span></span><br><span class="line"><span class="built_in">df</span> -h  <span class="comment"># 检查可用空间是否增加</span></span><br></pre></td></tr></table></figure><p>调整后可用空间来到了 907G</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> raid </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> raid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2025/07/13/hello-world/"/>
      <url>/2025/07/13/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
